---
date: 2025-11-06
tags: [raw]
---

# Raw Note

## 気づき (Observation)  
きっかけとなった金額不整合事件
(RCAレポートサマリー)

### 背景
健康経営推進の一環として、チーム会議用の飲食費10％割引制度を導入。  
社食・コンビニ双方で適用されたが、給与天引き額との突合で**金額不整合**が多数発覚。  
問い合わせ件数が急増し、社員の不信感と運用負荷が顕在化した。

### ユーザー発見経緯
ユーザー@社食
社食の決済端末で合計金額計算 --> 10%割引適用 --> ユーザーが確認の上決済

ユーザー@PC操作時
社食システムの画面上から決済履歴確認 --> 割引未適用金額発見 --> 問い合わせ

### 調査結果
- 天引きシステム側の連携金額は割引適用済み
- 履歴確認の画面表示のデータソーステーブルと、人事側への連携のデータソーステーブルが異なっていた
  - 画面表示は明細テーブルを参照して計算していた
  - 人事側の連携情報は、決済金額テーブルを参照していた

### 原因
- 表示ロジックと精算ロジックが分離していた。
- 社内に常駐する派遣やパートナーからの出向メンバー向けにも同じ割引を適用する都合、割引は社食システムで適用する必要があった。   
- 結果として、**天引きは正しいが、画面表示のみ誤っていた**。  
- 問題の根本は、**金額計算の責務が曖昧であったこと**と、異なる経路で生成された金額情報の不整合を検出する仕組みがなかったこと。

#### データテーブル構造側の要因
- 決済端末側では割引後の金額を送信していたが、決済履歴テーブルは**単純な数値格納のみ**で、割引情報の属性を持たなかった。  
- 明細テーブル（料理ごとの内訳）は「割引」という概念がなく、**割引行を追加する構造**になっていなかった。  
- 結果として、履歴テーブルでは割引後金額、人事連携は正、画面表示は割引前と**テーブル間で金額表現が乖離**した。


## 疑問 (Question)
- 特になし

## 次アクション (Next Step)
- 特になし