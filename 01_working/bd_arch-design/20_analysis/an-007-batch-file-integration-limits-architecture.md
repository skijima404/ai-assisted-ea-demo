---
id: an-007
date: 2025-11-06
title: batch-file-integration-limits-architecture
status: draft
tags: [analysis, integration, batch, coupling, migration]
---

# Incident (Observed Behavior)
- 社食の利用金額が「翌日にならないと反映されない」ため、ユーザーが月末に予算オーバーに気づけず、給与振込額が想定より少なくなるケースがある
- 新入社員が社食アプリを利用可能になるまで約1週間かかることがあり、その間は社食機能を十分に使えない
- 退職者のアカウント削除や無効化も即時には反映されず、「しばらく利用できてしまう」ケースが存在する
- システム間はすべてファイル連携＋バッチ処理で接続されており、**リアルタイムな状態反映が前提になっていない**

# Conclusion
**社食システムと人事システムの連携を、ファイル＋バッチ同期のみで設計しているため、ID・金額・ステータスの更新が遅延し、ユーザー体験と移行戦略の双方に構造的な制約を与えている。**

# Assumptions / Hypotheses
- 現行のシステム間連携は、Web API やメッセージングを用いないバッチ連携が前提になっている
- バッチ実行タイミングは業務都合（夜間処理／週次処理）で決められており、UX側の期待する「即時性」と整合していない
- 各システムは自律しており、**“単一の真実のソース” からプッシュされるモデルではなく、ファイル受け取り側がローカルコピーを持つモデル**になっている
- リリース戦略や段階的移行（Transition Architecture）の検討時にも、このバッチ前提が足かせになっている

# Reasoning
- 金額・ID・ステータスの更新はすべてバッチ連携に依存しているため、  
  - 利用金額の反映  
  - 社員情報の登録／更新  
  - 退職者の無効化  
  が **「翌日」あるいは「翌週」単位でしか反映されない**
- この構造は UX 観点では「遅延」として認識され、  
  - 月末の予算超過  
  - 新入社員の利用開始遅延  
  - 退職後もしばらく使えてしまう問題  
  として具体的な不満・リスクにつながっている
- また、移行戦略の観点でも、  
  - カットオーバー時期がバッチタイミングに縛られる  
  - 並行稼働や段階的移行が取りづらい  
  といった制約が生じる
- したがって問題は「バッチであること」そのものではなく、  
  **バッチ前提でしか連携パターンを持っていないために、UX・運用・移行の選択肢を自ら狭めていること** にある

# Implications
- 人事・社食間連携は、**「どのデータを、どの粒度と鮮度で同期すべきか」** を再定義し、  
  - IDライフサイクル（入社・異動・退職）はより高頻度／イベントドリブンに  
  - 金額・履歴表示は用途に応じた鮮度（当日／翌日）を明示的に設計  
  する必要がある
- Transition Architecture では：
  - すべてをリアルタイム API 化するのではなく、  
    - 即時性が必要なもの（ID有効・無効／残高系）  
    - バッチで十分なもの（レポート・集計）  
    を分割して連携パターンを設計する
  - 段階的移行のために、**ファイル連携とAPI連携が共存できるハイブリッド期間** を設計する
- バッチ前提のままでは、  
  - UX改善施策（リアルタイム残高表示など）が実現不能  
  - カットオーバー戦略が「一発切り替え」に限定される  
  ため、将来のモダナイゼーション全体に悪影響を与える

# Observations
- 社食・人事ともに Web API は提供されておらず、システム間データ連携はファイル＋バッチで行われている
- 金額の反映は翌日、社員情報の反映は翌週になるケースがある
- 退職者アカウントの無効化が即時に反映されず、退職後もしばらく利用できるケースがある
- 「同期的なシステム間連携がないことは移行にはメリットだが、リリース戦略が限定される」という認識が raw-notes に記録されている

# Evidence
- raw-notes/2025-11-06-integration-styles.md
- raw-notes/2025-11-06-other-complaints.md