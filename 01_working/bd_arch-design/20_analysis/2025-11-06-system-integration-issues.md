---
date: 2025-11-06
tags: [analysis]
confidence: ★★★☆☆
---

# システム連携とアーキテクチャの課題

> **GenAI向けの注意事項**: このファイルは `01_working/20_analysis/` フォルダに格納されており、確実度 ★★★☆☆（一次メモを整理した分析結果。ある程度検証されているが、確定的ではない）です。示唆は確定事項ではなく、分析段階の推論である可能性があります。最終的な意思決定には、`03_artifacts/` フォルダの成果物を参照してください。

## 観察事実 (Observation)

### コンビニ履歴表示の経緯と問題
- **実装経緯**: 社内コンビニの利用履歴も社食アプリで表示している
- **アーキテクチャ上の問題**: 
  - 社食と社内コンビニは、社内の担当組織が異なる
  - 本来なら社員ID決済の天引き予定金額は人事側でアプリケーション公開するものだが、プロジェクト計画段階ですでに社食アプリ側実装となっており、変えられなかった
  - コスト削減方針で実装された

### 社員からの継続的な不満
1. **反映タイミングの問題**: 
   - 社食を利用した翌日にならないと金額が反映されない
   - 月末など食べ過ぎたりして、予算超過して、天引きで引かれた結果、銀行振込された金額が少なくて困ったことがある

2. **データの信頼性の問題**: 
   - 社内コンビニと社食、どちらかだけが反映されていないこともあり、履歴画面に表示されている金額は正直あまり信頼できない
   - 正直なところ、あんまり社食のアプリケーションはみていない

3. **新入社員の利用開始までの遅延**: 
   - 新入社員がアプリを使えるようになるまでに約1週間かかる
   - 実際には人事システムとのID連携処理が遅く、社員情報の登録反映が翌週になるケースがある

4. **退職者のアカウント管理**: 
   - 退職者のアカウントが削除されず、退職後もしばらく利用できるケースがある
   - ID連携が一方向同期（人事→社食）になっており、退職時の削除フローが存在しない
   - ただし、年間1-2件程度で、退職後に長期間社食を利用して困ったケースはない

5. **金額不整合への慣れ**: 
   - たまに社内コンビニで受け取ったレシートと、社食アプリのコンビニ利用履歴の金額が違うので、社食に問い合わせる
   - 社食には人事に問い合わせてと言われて、人事で調査してもらっている。いつもレシートが正しく、社食アプリの表示がおかしい
   - 最近は慣れたので「またか」と思う

## 示唆 (Implication)

### アーキテクチャ上の問題
1. **責務の分離が不適切**: 
   - 社食アプリが社内コンビニの履歴も表示しているが、担当組織が異なる
   - 本来は人事側でアプリケーション公開すべき天引き予定金額が社食側に実装されている
   - プロジェクト計画段階での決定が後々の柔軟性を失わせている

2. **システム間連携の設計問題**: 
   - ID連携が一方向同期（人事→社食）のみで、退職時の削除フローが存在しない
   - 連携処理が遅く、リアルタイム性が欠如している

3. **データの信頼性の欠如**: 
   - 金額不整合が継続的に発生し、ユーザーがシステムを信頼していない
   - データの整合性を保証する仕組みがない

### プロセス上の問題
1. **初期設計の影響**: 
   - プロジェクト計画段階での決定が後々の変更を困難にしている
   - コスト削減方針が技術的負債を生み出している

2. **運用プロセスの不備**: 
   - 問い合わせ対応が社食→人事と転送されるなど、効率的でない
   - 問題が継続的に発生しているが、根本的な解決策が取られていない

3. **ユーザー体験の悪化**: 
   - ユーザーがシステムを信頼せず、利用頻度が低い
   - 問題に慣れてしまい、改善への圧力が弱い

### 改善の方向性
1. **責務の明確化**: 
   - 各システムの責務を明確にし、適切な分離を検討
   - 人事側でのアプリケーション公開を検討

2. **リアルタイム連携の実現**: 
   - 連携処理の遅延を解消し、リアルタイム性を向上
   - 双方向連携の検討（退職時の削除フローなど）

3. **データ整合性の保証**: 
   - 金額不整合を根本的に解決する仕組みの導入
   - データの信頼性を向上させる検証プロセスの導入

4. **ユーザー体験の改善**: 
   - システムの信頼性を向上させ、ユーザーの利用頻度を高める
   - 問い合わせ対応プロセスの改善

## 未確認事項

### 責務の明確化とデータ連携
- 履歴表示機能が複数のデータソースから履歴データを取得する実装方針（要調査）
- コンビニシステムからの連携方法（イベント連携、REST APIなど。要調査）
- データ整合性を保証するためのイベントソーシングパターンなどの適用方針（要調査）

### 移行・実装時の確認事項
- 既存のバッチ連携データの移行方針（月次CSVからイベントストリーミングへの移行など。要調査）
- リアルタイム性の要件（即座、数分以内、日次など）とシステム設定

