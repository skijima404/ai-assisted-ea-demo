---
id: an-201
date: 2025-11-06
title: csv-to-kafka-is-optimal-first-step
status: draft
tags: [analysis, migration, kafka]
---

# CSV to Kafka is the optimal initial migration step

## Incident (Observed Behavior)
- 現行システム間連携の多くが CSV ファイル連携に依存している。
- Target Architecture では Kafka をイベント基盤として活用する方針だが、開発チームに Kafka の運用・開発経験がほとんどない。
- 既存のアプリケーションは UI とビジネスロジックの結合度が高く、初手で UI/API リファクタリングに着手すると影響範囲が大きくなることが懸念されている。
- コンビニシステムとの連携は頻度が低く、先方システム側の改修タイミングに制約がある。

## Conclusion / Assumptions
- **結論:** 移行の最初のステップとして、既存の CSV 連携を Kafka 連携に置き換える（`CSV → Kafka`）アプローチを採用するのが最も現実的かつリスクが低い。
- **Assumptions:**
  - Kafka は今後の Target Architecture における中核コンポーネントであり、長期的にも利用が継続される。
  - CSV 連携は現在も安定稼働しており、業務的に信頼されている「鏡」として扱える。
  - コンビニシステム側は直接の改修が難しく、当面はこちら側で中継レイヤーを用意する必要がある。
  - 開発チームは Kafka に不慣れであり、最初のステップではスコープの小さい Quick Win が求められている。

## Reasoning
1. **UI/API から着手するリファクタリングはリスクが高い**  
   画面要素の多さや UI/ビジネスロジックの強い結合により、UI 層の改修は設計・テストコストともに高くなる。初手としては重すぎる。

2. **CSV は既に確立されたインターフェースであり、業務影響を最小化できる**  
   現行システムは CSV を前提とした運用ができており、フォーマット・出力タイミング・関係者の理解が揃っている。ここを起点に Kafka への橋渡しを行うことで、既存システム側の改修を最小限に抑えられる。

3. **Kafka の学習と Quick Win を両立できる**  
   `CSV → Kafka` の変換サービスを小さなスコープで実装することで、Kafka のトピック設計・スキーマ設計・エラーハンドリング・監視といった基礎を早期に学習できる。これは後続のマイクロサービス化・イベント駆動化の難易度を下げる。

4. **コンビニシステム側の改修タイミングに柔軟性を持たせられる**  
   中継として `CSV to Kafka` 変換サービス（Camel 等）をこちら側で実装することで、コンビニシステム本体の Kafka 対応は後ろ倒しにできる。事業側の制約とシステム改修のタイミングを分離できる。

5. **後続のイベント駆動アーキテクチャへの接続点になる**  
   一度 Kafka にデータが集約されれば、そこから人事システム・社食システム・会計システムなどへの配信を再設計しやすくなる。`CSV → Kafka` は「イベント駆動化へのゲートウェイ」として機能する。

## Implication
- 移行ロードマップの初手として `CSV → Kafka` を採用することで、
  - UI/BL リファクタリングを後ろにずらしつつ、
  - Kafka 基盤の運用経験とスキルをチーム内に蓄積し、
  - コンビニシステム・人事システム側の改修タイミングに柔軟性を持たせられる。
- このステップの設計品質が低いと、その後のイベント駆動化全体に影響するため、
  - トピック設計、
  - スキーマ管理（Schema Registry 等）、
  - エラーハンドリング／リトライ戦略、
  をこの段階から検討しておく必要がある。

## Observations
- CSV 連携は以下のような経路で多用されている：
  - コンビニシステム → 人事システム
  - コンビニシステム → 社食システム
  - 社食システム → 人事システム
  - 人事システム → 社食システム
- コンビニシステムの開発チームとの連携頻度は低く、当面はこちら側で変換レイヤーを持つ方が現実的であると判断されている。

## Evidence
- `01_working/ef_solutions/10_raw-notes/2025-11-06-csv-to-kafka.md`