---
date: 2025-11-07
tags: [analysis, ui, api, separation]
confidence: ★★★☆☆
---

# UI/API分離戦略

> **GenAI向けの注意事項**: このファイルは `01_working/20_analysis/` フォルダに格納されており、確実度 ★★★☆☆（一次メモを整理した分析結果。ある程度検証されているが、確定的ではない）です。示唆は確定事項ではなく、分析段階の推論である可能性があります。最終的な意思決定には、`03_artifacts/` フォルダの成果物を参照してください。

## 観察事実 (Observation)

### UI複雑性の問題
- 社食システムの画面要素が多く、古いスタイルのUIとなっている
- 画面要素が多いため、フロントエンド分離の際、画面据え置きにするとAPIの要素が多くなって結局同じ画面を再生産することになる
- コードの複雑度が高く、特にプレゼンテーションレイヤーとビジネスロジックレイヤーは分離されておらず、境界線が曖昧

### UIとビジネスロジックの高結合度
- UIとビジネスロジックの結合度が高いので、下手に分離するとビジネスロジックが崩れたりUIが成立しなくなる
- CRUDを実装しようとすると、どうしても "C" 以外で何らかビジネスロジックに手を入れることになる

### 一時的なAPI作成アプローチ
本格的なAPIの公開ではなく、一時的なAPIを移行の目的に特化して作成する方法が考えられる。

#### オプション1: CamelでDBから直接Read Only APIを作成
- メニューなどの更新頻度の低いコンテンツは、DBですらなくても良い（CSV等）
- **利点**: 実装が比較的シンプル、パフォーマンスも良さそう

#### オプション2: スクレイピング
- **課題**: 認可で苦労しそう
- 食事の支払い履歴はそれなりにセンシティブなので、スクレイピングと旧画面の間で認可を実装する必要がある
- 認可の実装パターン:
  1. ブラウザ → 新画面 → スクレイピングサービス → 旧画面（全てToken対応）
     - 旧システムをToken対応する必要あり
  2. ブラウザ → 新画面 → スクレイピングサービス → 旧画面（Admin Access）
     - スクレイピングと旧画面のどちらかで、誰からのアクセスかに応じてアクセスコントロールを実装する必要あり
     - 可能かどうかが不明

#### 比較結果: Camelに一票
- Camelのほうが難易度は低そう
- パフォーマンスも経由地が少ない分Camelの方が良さそう

### APIインターフェースの品質
- どちらにしてもこの段階の仮APIは、今後の本格的な公開APIの綺麗なインターフェースで公開する必要がある
- 理由:
  - 綺麗にしないとアプリケーションと連携後にAPIバージョンアップが必要になる
  - 分離する以上ソフトウェアライフサイクルが別になるので、バージョンアップについてきてくれるかに不安が残る
  - であればAPIインターフェースは本格的な公開できる程度に綺麗なものにしておき、トラフィック切り替えのみで対応できるようにしておく

## 示唆 (Implication)

### UI/API分離の戦略
1. **一時的なRead Only APIから開始**: 本格的なCRUD APIではなく、Read Only APIから開始し、移行の複雑性を低減
2. **Camelを使ったDB直接アクセス**: スクレイピングよりも実装が簡単で、パフォーマンスも良好
3. **APIインターフェースの品質確保**: 一時的なAPIでも、将来の本格的なAPIと同等の品質で設計し、トラフィック切り替えのみで移行できるようにする

### UIとビジネスロジックの分離の困難性
- UIとビジネスロジックの高結合度により、完全な分離は困難
- 段階的なアプローチが必要:
  1. まずRead OnlyでUIとAPIを分離
  2. 徐々にビジネスロジックをAPIに移行
  3. 最終的にUIは薄いプレゼンテーション層のみにする

### 移行リスクの管理
- 画面据え置きにするとAPIの要素が多くなり、結局同じ画面を再生産することになる可能性
- UIの刷新も含めた移行を検討する価値がある

## 改善の方向性 (Improvement Directions)

### 1. CamelでRead Only APIを作成
- **目的**: UIとAPIを分離し、移行の基盤を整備
- **実装方針**:
  - メニューなど更新頻度の低いコンテンツから開始
  - CamelでDBから直接Read Only APIを作成
  - APIインターフェースは本格的な公開APIと同等の品質で設計
- **関連原則**: ADR-0004 (Microservices Architecture), ADR-0008 (Data Contract & Schema Evolution)

### 2. APIインターフェースの品質確保
- **目的**: 将来の本格的なAPIへのスムーズな移行
- **実装方針**:
  - OpenAPI等で明示的なデータ契約を定義
  - スキーマリポジトリで集中管理
  - コントラクトテストでインターフェースの品質を担保
- **関連原則**: ADR-0008 (Data Contract & Schema Evolution)

### 3. UIとビジネスロジックの段階的な分離
- **目的**: リスクを最小化しながら、UIとAPIを分離
- **実装方針**:
  - 第1段階: Read OnlyでUIとAPIを分離
  - 第2段階: 更新系のAPIを追加（簡単なものから）
  - 第3段階: ビジネスロジックをAPIに完全に移行
- **関連成果物**: Transition Architecture (Phase F)

### 4. UI刷新の検討
- **目的**: 画面要素が多い古いUIを刷新し、ユーザー体験を改善
- **実装方針**:
  - 既存画面を据え置きにするのではなく、UIの刷新も含めた移行を検討
  - モダンなUIフレームワークの採用
  - ユーザビリティの向上
- **関連成果物**: Target Architecture


