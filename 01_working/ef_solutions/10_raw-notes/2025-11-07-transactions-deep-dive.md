---
date: 2025-11-07
tags: [raw]
---

# Raw Note

## 気づき (Observation)  
利用明細 (transactions) 部分の移行難易度詳細分析
- 難しい点
  - 旧と新が同じものではない
    - 旧: (コンビニデータソース部分の) 利用明細
    - 真: (コンビニデータソース + 社食データソースの) 利用明細
      - 現在は社食データソース部分は決済履歴 (payments) 部分が肩代わりしている
      - 本来人事にあるべき給料天引き金額を確認する目的なので、これは社食から切り離して人事側に移管する
        - 社食にある時は直接決済履歴を参照すればよかった
    - 同じものではないので、「同じ処理結果」を担保するには何を正としたら良いか
      - 1件ずつの処理ならシンプルでテストケースを今から立てられるので、リグレッションテストがないことの影響は限定的
      - 問題はネットワーク伝達を介したことによるパケットロス等の影響で
        - 「そもそも到達していないデータ」がないことを証明すること
        - 到達していないデータがあった場合でもリトライが十分であることを証明すること

- 鏡として使えそうなもの
  - CSV
    - これまでの運用でデータロスがないことは実証済みと考える
  - 人事側の現行の請求台帳
    - CSV同様、これまでの運用でデータロスがないことは実証済み
  - これから切り出す社食システムソースのマイクロサービス
    - 使えないこともないがその前にそのマイクロサービスへのデータ反映が十分であることをどう検証するか
      - レアケースが前段階で見逃されないとも限らない
      - 社内といえども支払い関連データなのでこれは少々怖い

- 段階移行
  - 利用明細そのものも段階移行できないか
    - コンビニデータソース部分
      - 現行利用明細相当、ほぼApple to Apple
      - CSV を鏡として使える
    - 社食システムの「決済履歴」から役割を引き継いで新設するところ
      - コンビニデータソース部分が先に検証できると考えると、残るは決済履歴 --> 新利用明細への単純なデータ同期なのでそれほど問題はなくなる
        - 複雑なのはテストの仕組みであって、機能移植ではない
        - 新利用明細サービスそのものは割とシンプルなCRUDサービス
        
## 疑問 (Question)
- 特になし

## 次アクション (Next Step)
- 特になし