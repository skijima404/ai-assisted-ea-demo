# Step 2: 決済履歴独立と人事側連携のデータソース変更

## 目的 (Purpose)
本ステップは、最終的なイベント駆動アーキテクチャ移行に向けた第2段階として、社食システムの決済履歴を独立させ、人事システムとのデータ連携をモダナイズすることを目的とする。社食システムから既存機能 (決済履歴) をマイクロサービス化し、その状態で新旧環境並行稼働での動作検証を実施する。

## 範囲 (Scope)
- **決済履歴独立**
  - 社食の決済履歴を社食システムから独立させ、マイクロサービスとして切り出す

- **データ連携**
  - 人事側へのデータ連携のデータソースを、マイクロサービス側に変更する

### スコープ外
- 社食システムのUIに表示する決済履歴データのデータソース変更

## 制約 (Constraints)
- フロントエンドバックエンド分離が現段階では難しいため、UI表示のデータソースは変更しない

## Consequences

### Positive
- 既存機能を切り出す作業をここで実施し、開発およびダークローンチによる本番稼働環境でのテストの組織的な学習を実施。

### Negative
- 新旧並行運用が発生することにより、SSoTの原則が一時的に崩れる
  - 運用コストの一時的な増加
- 新旧の整合確認が必要となり、検証工数が一時的に増加

### Mitigations 
- 二重運用期間を明示的に設定（最大3ヶ月）し、突合プロセスを標準化  
- Kafkaへの習熟を前のステップで実施しておくことにより、ネットワーク起因のトラブルへの経験をあらかじめ積んでおく
- 突合頻度（例：日次）を明示し、スクリプトまたはCamel等で自動化を検討

## Testing & Verification
詳細な検証方針は `step-2-testing.md` を参照。

## Reference
- principle-001: Single Source of Truth  
- principle-002: リアルタイムデータ処理  
- principle-003: イベント駆動アーキテクチャ  