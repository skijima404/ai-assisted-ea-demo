# ステップ5 テストおよびリリースポリシー

## 概要
本ドキュメントは、**Transition Architecture Step 5**（最終統合・API完全分離）におけるテストおよびリリースポリシーを定義します。  
最終的なAPI統合の検証、同時アクセス時の負荷挙動の評価、ユーザーリリース準備の確認に重点を置いています。

なお、Step 4移行対象のPrivateAPI、PublicAPI、BillAPIはStep 4側で実施中です。  
本Step 5では、主に社食側のAPI（UserProfileAPI、MenuAPI）を対象とします。  
Step 4とStep 5は人事側／社食側というドメイン分離に基づく構成のため、実質的には並行して進めることが可能です。

---

## 1. テスト範囲

- いずれも単純なCRUD操作のみを提供するAPIであり、複雑なビジネスロジックは持ちません。  
- 本ステップでは、UI–API間の連携と基本的な動作確認に重点を置きます。  
- CDC（Change Data Capture）によるリアルタイム突合は不要です。  
- 並行稼働によるテストも不要とします。  
- 検証項目：  
  - CRUD操作の正確性（Create, Read, Update, Delete）  
  - 権限管理（認可スコープ）とData Classification Policyとの整合性  
  - APIスキーマの後方互換性維持  
  - API Gateway経由でのレイテンシおよび認可の整合性

---

## 2. テストピラミッドの検証
- テストピラミッドの正常化が達成されているかを本ステップで確認します。  
- 単体テスト／統合テスト／E2Eテストがそれぞれ明確に分離され、E2Eテストへの過剰依存が解消されているかを検証します。  
- 自動テスト結果をCI/CDパイプラインで集約・可視化し、テストカバレッジを測定します。  
- 同時アクセスおよびAPI Gatewayルーティングをシミュレートした合成E2Eテストを含みます。

---

## 3. 監視およびリリース
- 本ステップで追加されるAPIは**本番リリース扱い**とします。  
- OpenShiftのメトリクスとログでAPIのレイテンシおよびスループットを監視します。  
- 約1週間のライブ監視期間を設け、異常がなければ安定稼働とみなします。

---

## 4. 制約および依存関係
- PIIを含むAPIは、利用前にHR部門がデータ精査およびマスキングルールを定義します。  
- Data Classification Policy準拠のアクセス制御を適用します。  
- すべてのAPIはリリース前にAPI Gatewayの契約検証を通過する必要があります。  
- テストピラミッドによる品質保証体制が整備されていることを前提とします。

---

## 5. 参照
- Step 4 Testing Policy (HR Domain APIs)  
- principle-007: Observability  
- adr-0012: テストと品質保証の再構築