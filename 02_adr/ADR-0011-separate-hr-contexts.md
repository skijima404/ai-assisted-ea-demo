# ADR-0011: HRコンテキストの分離

## Status
Accepted

## Context
現在のシステムでは、人事（HR）関連データが社食・決済・勤怠など他の業務コンテキストと同一のデータソース内で扱われている。  
これにより、機能的には便利である一方で、個人情報の取扱い範囲が広がり、不要な参照リスクが増加している。  

## Decision
人事関連データ（社員基本情報、雇用状態、給与天引き情報など）を独立したHRコンテキストとして分離する。  
このコンテキストは、他システムとはイベント連携またはAPIを介してのみデータを授受する。  
人事情報を参照する必要がある業務コンテキスト（例: 社食、コンビニ決済）は、最小限の属性のみをサブスクライブする形に変更する。

### Alternatives Considered
- **現状維持:** 最も低コストだが、セキュリティおよびデータガバナンス上のリスクを継続。
- **部分的分離:** 一部属性のみをHR外部に残すが、完全分離に比べ複雑性が増す。
- **完全分離 (採用):** データ境界を明確にし、アクセス制御を統一。

## Implications
- データモデリングを再設計し、HR情報のアクセスパスを整理する必要がある。
- HRシステム側にイベント発行基盤を設置し、他システムが購読できる形で公開する。
- 一部業務ロジック（社食利用登録、給与天引き処理など）を再配置する必要がある。
- HRコンテキスト外にデータを出す際は、内容精査・クレンジングプロセスを必須とする。
  - 個人識別情報（氏名、社員番号、雇用契約情報など）は原則非公開。
  - 例外的に共有が必要な場合は、マスキングまたは匿名化を行う。

## Consequences

### Positive
- 個人情報の取扱い範囲を最小化でき、セキュリティリスクを大幅に低減。
- HRシステムの独立性が高まり、変更や法改正への対応が容易。
- 他システム側では、参照する情報が限定されるためデータ整合性が向上。

### Negative
- 初期段階では開発・移行コストが発生。
- 一部連携処理にイベント遅延や一時的なデータ不整合リスクが生じる可能性。

### Mitigations
- Kafka等のイベントストリーミングを活用して遅延を最小化。
- アクセス制御・認可をKeycloak等の共通基盤で一元管理。
- 段階的移行を行い、既存システムへの影響を抑制。

## Reference
- Principle-006: Security First  
- Principle-001: Single Source of Truth
- Data Classification Policy (`10_standards/data-classification.md`)
