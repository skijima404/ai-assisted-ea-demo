# ADR-0007: Observability (観測可能性)

## Status
Accepted

## Context

### 問題の背景

現状、システムの状態を把握する仕組みが不十分である。

**監視の不備**:
- システムの状態を一目で把握する仕組みがない
- バックプレッシャー（負荷による遅延）が可視化されておらず、外部システムの都合がUI/運用に波及している
- 問題発生時の原因特定が困難

**監査証跡の分散**:
- 取引の原記録と請求合算の紐付けが弱い
- 監査証跡が複数システムに分散しており、追跡が困難
- 金額不整合が発生した際に、どのデータが正しいか判断できない

**ユーザー体験への影響**:
- データの整合性問題が継続的に発生しているが、根本原因が特定できない
- 「またか」とユーザーが諦めるほど、問題が継続している

**マイクロサービス化による複雑性**:
- マイクロサービスアーキテクチャを採用すると、システム全体の複雑性が増加
- サービス間通信のデバッグや運用が複雑になる
- 分散システムの状態把握が困難

**ビジョンとの関連**:
- アーキテクチャビジョン「3. 柔軟で持続可能なシステム基盤の実現 - 安心して運用できる見える化」を実現するため

## Decision

**「Observability (観測可能性)」原則を採用する**

システムの状態を一目で把握できるよう、ログ、メトリクス、トレースを統合して監視する。問題が起きた際も迅速に対応できる体制を整える。

### 実装への影響（Implications）
- ログ、メトリクス、トレースを統合して監視する
- システムの状態を可視化するダッシュボードを構築する
- アラート設定により、問題を早期に検知する
- 監査証跡を統合管理する
- 問題発生時の迅速な対応体制を整える

### 関連する原則
- ADR-0004: Microservices Architecture（分散システムの可視化）

## Consequences

### Positive
- システムの状態を一目で把握でき、問題が起きた際も迅速に対応できる
- 監査証跡を統合管理することで、取引の原記録と請求合算の紐付けを強化
- バックプレッシャーを可視化し、外部都合のUI/運用への波及を防ぐ
- マイクロサービス化による複雑性に対応できる
- 問題の根本原因を特定しやすくなる

### Negative
- ログ、メトリクス、トレースの統合基盤の導入コストが発生
- 監視データの収集・保存にリソースが必要
- 運用チームのスキルアップが必要

### Mitigation
- プラットフォーム層で共通の監視基盤を提供し、各サービスの重複を防ぐ
- ダッシュボードを整備し、運用負荷を軽減
- トレーニングプログラムで運用チームのスキルアップを支援

## Reference
- Architecture Vision: `03_arch-artifacts/arch-vision.md`
- Analysis: `01_working/bd_arch-design/20_analysis/2025-11-06-system-integration-issues.md`
- Principle: `03_arch-artifacts/principles/principle-007-observability.md`

