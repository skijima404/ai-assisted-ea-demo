# Step 3: UI独立

## 目的 (Purpose)
本ステップはフロントエンドとバックエンドを分離し、次のステップ以降でHTTPのトラフィックルーティングを用いたユーザーリリースの柔軟性を担保することを目的とする。
テスト実施後UIはユーザー公開する。

## 範囲 (Scope)
- **フロントエンド独立**
  - 社食: 社食UI
  - 人事: 天引き情報UI
- **データ連携**
  - フロントエンド/バックエンドをWeb APIで連携
- **API Gateway導入**
  - API Gatewayを導入
  - 認証をOIDCに切り替え
- **社食APIの構築**
  - 移行期間はRead Onlyとする
  - Camelを用いて簡易的に実装する

## 制約 (Constraints)
- Web APIはCamelを用いて簡易的に実装する
  - 移行期間の措置となるため、Read Onlyとし、社食アプリ以外には利用させない
- 天引き情報UIは人事側で開発する
- 社食APIは今後の本格稼働を念頭に置き、汎用性の高いAPI UIを実現する

## Consequences

### Positive
- 本格的なWeb APIのContract Test、UIからのE2Eテストを実施する。テストピラミッドの各テスト工程のテストケースボリュームの検証ができる。
- この段階でUIのデータソースの決済履歴をマイクロサービス側に倒し、二重運用を解消できる
- メニューデータへのアクセスはキャッシュを導入できる
  - 必要に応じて検討
- API Gatewayやアプリケーション監視 (あるいはService Mesh) を使用し、エンドポイントごとにトランザクション数のログや分散トレーシング等での詳細なログを取得できる

### Negative
- UIとバックエンドを分離することで、ネットワーク経由の通信遅延や認証まわりの不整合が発生するリスクがある。
- 一時的にCamel経由のRead Only APIを利用するため、UIからの操作に対して機能制限（Write不可）が発生する。
- OIDC認証切替により、既存アカウント管理・SSO連携の不具合が顕在化するリスク。

### Mitigations
- 通信遅延やネットワーク不具合を早期検知できるよう、API Gateway と Observability 基盤でメトリクスを収集・監視する。
- APIのレイテンシ監視により、スループット・レスポンスタイムの閾値を超過した場合に自動アラートを発報。
- Camel API の利用を移行限定とし、Write 操作が必要な機能は従来アプリ側で継続利用させることでユーザー影響を回避。
- 認証まわりのトラブル対応として、OIDC切替を段階的に実施し、既存セッション有効期間中はフォールバック認証を許可。

## Reference
